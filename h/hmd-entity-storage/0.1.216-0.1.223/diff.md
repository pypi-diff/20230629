# Comparing `tmp/hmd_entity_storage-0.1.216-py3-none-any.whl.zip` & `tmp/hmd_entity_storage-0.1.223-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,30 +1,30 @@
-Zip file size: 32945 bytes, number of entries: 28
--rw-rw-rw-  2.0 unx      214 b- defN 23-Feb-28 20:01 hmd_entity_storage/__init__.py
--rw-rw-rw-  2.0 unx     2874 b- defN 23-Feb-28 20:01 hmd_entity_storage/gremlin_query_support.py
--rw-rw-rw-  2.0 unx      393 b- defN 23-Feb-28 20:01 hmd_entity_storage/hmd_entity_storage.py
--rw-r--r--  2.0 unx       38 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/README
--rw-r--r--  2.0 unx     1940 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/alembic.ini
--rw-r--r--  2.0 unx     2287 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/env.py
--rw-r--r--  2.0 unx      494 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/script.py.mako
--rw-r--r--  2.0 unx     1641 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/__pycache__/env.cpython-39.pyc
--rw-r--r--  2.0 unx     1222 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/12cdb83620a9_add_relationship.py
--rw-r--r--  2.0 unx     1139 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/91c9eec02046_name_to_entity.py
--rw-r--r--  2.0 unx     1480 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/affe724897f1_initial_tables.py
--rw-r--r--  2.0 unx      448 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/bdf0a12db196_add_name_index.py
--rw-r--r--  2.0 unx     1225 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/__pycache__/12cdb83620a9_add_relationship.cpython-39.pyc
--rw-r--r--  2.0 unx     1291 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/__pycache__/91c9eec02046_name_to_entity.cpython-39.pyc
--rw-r--r--  2.0 unx     1406 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/__pycache__/affe724897f1_initial_tables.cpython-39.pyc
--rw-r--r--  2.0 unx      782 b- defN 23-Feb-28 20:01 hmd_entity_storage/alembic/versions/__pycache__/bdf0a12db196_add_name_index.cpython-39.pyc
--rw-rw-rw-  2.0 unx        0 b- defN 23-Feb-28 20:01 hmd_entity_storage/auditor/__init__.py
--rw-rw-rw-  2.0 unx    11657 b- defN 23-Feb-28 20:01 hmd_entity_storage/auditor/engine_auditor.py
--rw-rw-rw-  2.0 unx      219 b- defN 23-Feb-28 20:01 hmd_entity_storage/engines/__init__.py
--rw-rw-rw-  2.0 unx     5138 b- defN 23-Feb-28 20:01 hmd_entity_storage/engines/base_engine.py
--rw-rw-rw-  2.0 unx    16558 b- defN 23-Feb-28 20:01 hmd_entity_storage/engines/dynamodb_engine.py
--rw-rw-rw-  2.0 unx    15571 b- defN 23-Feb-28 20:01 hmd_entity_storage/engines/gremlin_engine.py
--rw-rw-rw-  2.0 unx    21672 b- defN 23-Feb-28 20:01 hmd_entity_storage/engines/postgres_engine.py
--rw-rw-rw-  2.0 unx    13257 b- defN 23-Feb-28 20:01 hmd_entity_storage/engines/sqlite_engine.py
--rw-rw-rw-  2.0 unx     2004 b- defN 23-Feb-28 20:01 hmd_entity_storage-0.1.216.dist-info/METADATA
--rw-rw-rw-  2.0 unx       92 b- defN 23-Feb-28 20:01 hmd_entity_storage-0.1.216.dist-info/WHEEL
--rw-rw-rw-  2.0 unx       19 b- defN 23-Feb-28 20:01 hmd_entity_storage-0.1.216.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2993 b- defN 23-Feb-28 20:01 hmd_entity_storage-0.1.216.dist-info/RECORD
-28 files, 108054 bytes uncompressed, 27873 bytes compressed:  74.2%
+Zip file size: 33399 bytes, number of entries: 28
+-rw-rw-rw-  2.0 unx      214 b- defN 23-Apr-24 15:52 hmd_entity_storage/__init__.py
+-rw-rw-rw-  2.0 unx     2954 b- defN 23-Apr-24 15:52 hmd_entity_storage/gremlin_query_support.py
+-rw-rw-rw-  2.0 unx      393 b- defN 23-Apr-24 15:52 hmd_entity_storage/hmd_entity_storage.py
+-rw-r--r--  2.0 unx       38 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/README
+-rw-r--r--  2.0 unx     1940 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/alembic.ini
+-rw-r--r--  2.0 unx     2287 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/env.py
+-rw-r--r--  2.0 unx      494 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/script.py.mako
+-rw-r--r--  2.0 unx     1641 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/__pycache__/env.cpython-39.pyc
+-rw-r--r--  2.0 unx     1222 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/12cdb83620a9_add_relationship.py
+-rw-r--r--  2.0 unx     1139 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/91c9eec02046_name_to_entity.py
+-rw-r--r--  2.0 unx     1480 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/affe724897f1_initial_tables.py
+-rw-r--r--  2.0 unx      448 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/bdf0a12db196_add_name_index.py
+-rw-r--r--  2.0 unx     1225 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/__pycache__/12cdb83620a9_add_relationship.cpython-39.pyc
+-rw-r--r--  2.0 unx     1291 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/__pycache__/91c9eec02046_name_to_entity.cpython-39.pyc
+-rw-r--r--  2.0 unx     1406 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/__pycache__/affe724897f1_initial_tables.cpython-39.pyc
+-rw-r--r--  2.0 unx      782 b- defN 23-Apr-24 15:52 hmd_entity_storage/alembic/versions/__pycache__/bdf0a12db196_add_name_index.cpython-39.pyc
+-rw-rw-rw-  2.0 unx        0 b- defN 23-Apr-24 15:52 hmd_entity_storage/auditor/__init__.py
+-rw-rw-rw-  2.0 unx    11657 b- defN 23-Apr-24 15:52 hmd_entity_storage/auditor/engine_auditor.py
+-rw-rw-rw-  2.0 unx      219 b- defN 23-Apr-24 15:52 hmd_entity_storage/engines/__init__.py
+-rw-rw-rw-  2.0 unx     5138 b- defN 23-Apr-24 15:52 hmd_entity_storage/engines/base_engine.py
+-rw-rw-rw-  2.0 unx    16558 b- defN 23-Apr-24 15:52 hmd_entity_storage/engines/dynamodb_engine.py
+-rw-rw-rw-  2.0 unx    17116 b- defN 23-Apr-24 15:52 hmd_entity_storage/engines/gremlin_engine.py
+-rw-rw-rw-  2.0 unx    21672 b- defN 23-Apr-24 15:52 hmd_entity_storage/engines/postgres_engine.py
+-rw-rw-rw-  2.0 unx    13257 b- defN 23-Apr-24 15:52 hmd_entity_storage/engines/sqlite_engine.py
+-rw-rw-rw-  2.0 unx     2004 b- defN 23-Apr-24 15:52 hmd_entity_storage-0.1.223.dist-info/METADATA
+-rw-rw-rw-  2.0 unx       92 b- defN 23-Apr-24 15:52 hmd_entity_storage-0.1.223.dist-info/WHEEL
+-rw-rw-rw-  2.0 unx       19 b- defN 23-Apr-24 15:52 hmd_entity_storage-0.1.223.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2993 b- defN 23-Apr-24 15:52 hmd_entity_storage-0.1.223.dist-info/RECORD
+28 files, 109679 bytes uncompressed, 28327 bytes compressed:  74.2%
```

## zipnote {}

```diff
@@ -66,20 +66,20 @@
 
 Filename: hmd_entity_storage/engines/postgres_engine.py
 Comment: 
 
 Filename: hmd_entity_storage/engines/sqlite_engine.py
 Comment: 
 
-Filename: hmd_entity_storage-0.1.216.dist-info/METADATA
+Filename: hmd_entity_storage-0.1.223.dist-info/METADATA
 Comment: 
 
-Filename: hmd_entity_storage-0.1.216.dist-info/WHEEL
+Filename: hmd_entity_storage-0.1.223.dist-info/WHEEL
 Comment: 
 
-Filename: hmd_entity_storage-0.1.216.dist-info/top_level.txt
+Filename: hmd_entity_storage-0.1.223.dist-info/top_level.txt
 Comment: 
 
-Filename: hmd_entity_storage-0.1.216.dist-info/RECORD
+Filename: hmd_entity_storage-0.1.223.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## hmd_entity_storage/gremlin_query_support.py

```diff
@@ -4,15 +4,14 @@
 import backoff
 from gremlin_python.driver.client import Client
 
 operator_map = {">=": "gte", ">": "gt", "<=": "lte", "<": "lt", "=": "eq", "!=": "neq"}
 
 
 def is_search_criteria(param: Any):
-
     if not isinstance(param, Dict):
         return False
 
     return (len(param) == 1 and all(key in ["and", "or"] for key in param.keys())) or (
         len(param) == 3
         and all(
             key in ["value", "attribute", "operator", "attribute_target"]
@@ -25,25 +24,27 @@
     """A method used by the backoff decorator to reset the connection"""
     gqs: GremlinQuerySupport
     gqs = data["args"][0]
     gqs.initialize_client()
 
 
 class GremlinQuerySupport:
-    def __init__(self, host: str, port: str, query_definitions: Dict):
+    def __init__(
+        self, host: str, port: str, query_definitions: Dict, protocol: str = "wss"
+    ):
         self.host = host
         self.port = port
+        self.protocol = protocol
         self.query_definitions = query_definitions
         self.initialize_client()
 
     def initialize_client(self):
-        self.client = Client(f"wss://{self.host}:{self.port}/gremlin", "g")
+        self.client = Client(f"{self.protocol}://{self.host}:{self.port}/gremlin", "g")
 
     def execute_query(self, query_name: str, query_values: Dict) -> List[Any]:
-
         if query_name not in self.query_definitions:
             raise Exception(f"Query, {query_name}, not found.")
 
         query_definition = self.query_definitions[query_name]
         values = deepcopy(query_values)
         for key in values:
             if is_search_criteria(values[key]):
```

## hmd_entity_storage/alembic/__pycache__/env.cpython-39.pyc

 * *Format-specific differences are supported for Python .pyc files but no file-specific differences were detected; falling back to a binary diff. file(1) reports: Byte-compiled Python module for CPython 3.9, timestamp-based, .py timestamp: Tue Feb 28 20:01:11 2023 UTC, .py size: 2287 bytes*

 * *Could not decompile bytecode: bad marshal data (unknown type code)*

```diff
@@ -1,8 +1,8 @@
-00000000: 610d 0d0a 0000 0000 875d fe63 ef08 0000  a........].c....
+00000000: 610d 0d0a 0000 0000 a9a5 4664 ef08 0000  a.........Fd....
 00000010: e300 0000 0000 0000 0000 0000 0000 0000  ................
 00000020: 0002 0000 0040 0000 0073 6c00 0000 6400  .....@...sl...d.
 00000030: 6401 6c00 5a00 6400 6402 6c01 6d02 5a02  d.l.Z.d.d.l.m.Z.
 00000040: 0100 6400 6403 6c03 6d04 5a04 0100 6400  ..d.d.l.m.Z...d.
 00000050: 6404 6c03 6d05 5a05 0100 6400 6405 6c06  d.l.m.Z...d.d.l.
 00000060: 6d07 5a07 0100 6507 6a08 5a08 6401 5a09  m.Z...e.j.Z.d.Z.
 00000070: 6406 6407 8400 5a0a 6408 6409 8400 5a0b  d.d...Z.d.d...Z.
```

## hmd_entity_storage/alembic/versions/__pycache__/12cdb83620a9_add_relationship.cpython-39.pyc

 * *Format-specific differences are supported for Python .pyc files but no file-specific differences were detected; falling back to a binary diff. file(1) reports: Byte-compiled Python module for CPython 3.9, timestamp-based, .py timestamp: Tue Feb 28 20:01:11 2023 UTC, .py size: 1222 bytes*

 * *Could not decompile bytecode: bad marshal data (unknown type code)*

```diff
@@ -1,8 +1,8 @@
-00000000: 610d 0d0a 0000 0000 875d fe63 c604 0000  a........].c....
+00000000: 610d 0d0a 0000 0000 a9a5 4664 c604 0000  a.........Fd....
 00000010: e300 0000 0000 0000 0000 0000 0000 0000  ................
 00000020: 0002 0000 0040 0000 0073 3c00 0000 6400  .....@...s<...d.
 00000030: 5a00 6401 6402 6c01 6d02 5a02 0100 6401  Z.d.d.l.m.Z...d.
 00000040: 6403 6c03 5a04 6404 5a05 6405 5a06 6403  d.l.Z.d.Z.d.Z.d.
 00000050: 5a07 6403 5a08 6406 6407 8400 5a09 6408  Z.d.Z.d.d...Z.d.
 00000060: 6409 8400 5a0a 6403 5300 290a 7a68 656d  d...Z.d.S.).zhem
 00000070: 7074 7920 6d65 7373 6167 650a 0a52 6576  pty message..Rev
```

## hmd_entity_storage/alembic/versions/__pycache__/91c9eec02046_name_to_entity.cpython-39.pyc

 * *Format-specific differences are supported for Python .pyc files but no file-specific differences were detected; falling back to a binary diff. file(1) reports: Byte-compiled Python module for CPython 3.9, timestamp-based, .py timestamp: Tue Feb 28 20:01:11 2023 UTC, .py size: 1139 bytes*

 * *Could not decompile bytecode: bad marshal data (unknown type code)*

```diff
@@ -1,8 +1,8 @@
-00000000: 610d 0d0a 0000 0000 875d fe63 7304 0000  a........].cs...
+00000000: 610d 0d0a 0000 0000 a9a5 4664 7304 0000  a.........Fds...
 00000010: e300 0000 0000 0000 0000 0000 0000 0000  ................
 00000020: 0002 0000 0040 0000 0073 3c00 0000 6400  .....@...s<...d.
 00000030: 5a00 6401 6402 6c01 6d02 5a02 0100 6401  Z.d.d.l.m.Z...d.
 00000040: 6403 6c03 5a04 6404 5a05 6405 5a06 6403  d.l.Z.d.Z.d.Z.d.
 00000050: 5a07 6403 5a08 6406 6407 8400 5a09 6408  Z.d.Z.d.d...Z.d.
 00000060: 6409 8400 5a0a 6403 5300 290a 7a69 6e61  d...Z.d.S.).zina
 00000070: 6d65 5f74 6f5f 656e 7469 7479 0a0a 5265  me_to_entity..Re
```

## hmd_entity_storage/alembic/versions/__pycache__/affe724897f1_initial_tables.cpython-39.pyc

 * *Format-specific differences are supported for Python .pyc files but no file-specific differences were detected; falling back to a binary diff. file(1) reports: Byte-compiled Python module for CPython 3.9, timestamp-based, .py timestamp: Tue Feb 28 20:01:11 2023 UTC, .py size: 1480 bytes*

 * *Could not decompile bytecode: bad marshal data (unknown type code)*

```diff
@@ -1,8 +1,8 @@
-00000000: 610d 0d0a 0000 0000 875d fe63 c805 0000  a........].c....
+00000000: 610d 0d0a 0000 0000 a9a5 4664 c805 0000  a.........Fd....
 00000010: e300 0000 0000 0000 0000 0000 0000 0000  ................
 00000020: 0002 0000 0040 0000 0073 3c00 0000 6400  .....@...s<...d.
 00000030: 5a00 6401 6402 6c01 6d02 5a02 0100 6401  Z.d.d.l.m.Z...d.
 00000040: 6403 6c03 5a04 6404 5a05 6403 5a06 6403  d.l.Z.d.Z.d.Z.d.
 00000050: 5a07 6403 5a08 6405 6406 8400 5a09 6407  Z.d.Z.d.d...Z.d.
 00000060: 6408 8400 5a0a 6403 5300 2909 7a5d 696e  d...Z.d.S.).z]in
 00000070: 6974 6961 6c20 7461 626c 6573 0a0a 5265  itial tables..Re
```

## hmd_entity_storage/alembic/versions/__pycache__/bdf0a12db196_add_name_index.cpython-39.pyc

 * *Format-specific differences are supported for Python .pyc files but no file-specific differences were detected; falling back to a binary diff. file(1) reports: Byte-compiled Python module for CPython 3.9, timestamp-based, .py timestamp: Tue Feb 28 20:01:11 2023 UTC, .py size: 448 bytes*

 * *Could not decompile bytecode: bad marshal data (unknown type code)*

```diff
@@ -1,8 +1,8 @@
-00000000: 610d 0d0a 0000 0000 875d fe63 c001 0000  a........].c....
+00000000: 610d 0d0a 0000 0000 a9a5 4664 c001 0000  a.........Fd....
 00000010: e300 0000 0000 0000 0000 0000 0000 0000  ................
 00000020: 0002 0000 0040 0000 0073 3c00 0000 6400  .....@...s<...d.
 00000030: 5a00 6401 6402 6c01 6d02 5a02 0100 6401  Z.d.d.l.m.Z...d.
 00000040: 6403 6c03 5a04 6404 5a05 6405 5a06 6403  d.l.Z.d.Z.d.Z.d.
 00000050: 5a07 6403 5a08 6406 6407 8400 5a09 6408  Z.d.Z.d.d...Z.d.
 00000060: 6409 8400 5a0a 6403 5300 290a 7a69 6164  d...Z.d.S.).ziad
 00000070: 645f 6e61 6d65 5f69 6e64 6578 0a0a 5265  d_name_index..Re
```

## hmd_entity_storage/engines/gremlin_engine.py

```diff
@@ -16,15 +16,18 @@
 
 logger = logging.getLogger(__name__)
 logger.setLevel(logging.INFO)
 
 CREATED_PROPERTY = "_created"
 UPDATED_PROPERTY = "_updated"
 INSTANCE_NAME_PROPERTY = "_instance_name"
-MANAGED_PROPERTIES = [T.id, T.label, INSTANCE_NAME_PROPERTY]
+MANAGED_PROPERTIES = [T.id, T.label, "__id", INSTANCE_NAME_PROPERTY]
+TRAVERSAL_STRATEGIES = [
+    SubgraphStrategy(vertices=__.hasNot("is_deleted"), edges=__.hasNot("is_deleted")),
+]
 operator_map = {">=": P.gte, ">": P.gt, "<=": P.lte, "<": P.lt, "=": P.eq, "!=": P.neq}
 
 
 def add_properties(g, properties: Dict[str, Any], isSingle=True):
     for k, v in properties.items():
         if isSingle:
             g = g.property(Cardinality.single, k, v)
@@ -49,35 +52,49 @@
     engine: GremlinEngine
     engine = data["args"][0]
     engine.initialize_connection()
 
 
 class GremlinEngine(BaseEngine):
     def __init__(
-        self, host: str, user: str = "hmdroot", password: str = "", port: int = 8182
+        self,
+        host: str,
+        user: str = "hmdroot",
+        password: str = "",
+        port: int = 8182,
+        protocol: str = "wss",
+        with_strategies: bool = True,
     ):
         self.host = host
         self.port = port
         self.user = user
         self.password = password
+        self.protocol = protocol
+        # with_strategies config option to enable required TraversalStrategies in Python if True
+        # or init traversal without if False, and assume they are added on the server.
+        self.with_strategies = with_strategies
         self.initialize_connection()
 
     def initialize_connection(self):
         remoteConn = DriverRemoteConnection(
-            f"wss://{self.host}:{self.port}/gremlin", "g"
+            f"{self.protocol}://{self.host}:{self.port}/gremlin", "g"
         )
         self._g = traversal().withRemote(remoteConn)
 
     def _get_g(self):
-        # return self._g
-        return self._g.withStrategies(
-            SubgraphStrategy(
-                vertices=__.hasNot("is_deleted"), edges=__.hasNot("is_deleted")
-            )
-        )
+        """Return the Gremlin graph traversal.
+        If self.with_strategies is True, then we add the necessary SubgraphStrategy to filter out is_deleted=True vertices and edges to the Python client traversal
+        If self.with_strategies is False, we return the bare traversal and assume the Gremlin Server graph was configured with the strategy.
+        """
+        if not self.with_strategies:
+            # Return bare graph traversal without SubgraphStrategy
+            return self._g
+
+        # Add SubgraphStrategy to filter out deleted records
+        return self._g.withStrategies(*TRAVERSAL_STRATEGIES)
 
     def get_entity(self, entity_def: Type[Entity], id_: str) -> Entity:
         if issubclass(entity_def, Noun):
             return self.get_noun(entity_def, id_)
         else:
             return self.get_relationship(entity_def, id_)
 
@@ -103,40 +120,41 @@
                 entity = self.get_relationship(entity_def, id_)
                 if entity:
                     result.append(entity)
         return result
 
     def _make_noun(self, noun_def: Type[Noun], data: Dict):
         data["identifier"] = data[T.id]
+
+        if not isinstance(data["identifier"], str):
+            data["identifier"] = data["__id"]
         return Entity.deserialize(noun_def, remove_managed_properties_and_delist(data))
 
     @backoff.on_exception(
         backoff.constant,
         (Exception,),
         max_tries=2,
         on_backoff=backoff_initialize_connection,
         interval=1,
     )
     def get_noun(self, entity_def: Type[Noun], id_: str) -> Noun:
-
         data = self._get_g().V(id_).valueMap(True).toList()
         if data:
             return self._make_noun(entity_def, data[0])
         else:
             return None
 
     @backoff.on_exception(
         backoff.constant,
         (Exception,),
         max_tries=2,
         on_backoff=backoff_initialize_connection,
         interval=1,
     )
     def get_relationship(self, entity_def: Type[Relationship], id_: str) -> Noun:
-
         data = (
             self._get_g()
             .E(id_)
             .as_("rel")
             .inV()
             .as_("to")
             .select("rel")
@@ -209,15 +227,14 @@
         max_tries=2,
         on_backoff=backoff_initialize_connection,
         interval=1,
     )
     def search_relationship(
         self, entity_def: Type[Relationship], search_filter: Dict[str, Any] = dict()
     ) -> List[Noun]:
-
         self._validate_search_criteria(entity_def.entity_definition(), search_filter)
         results = self._get_g().E().hasLabel(entity_def.get_namespace_name())
         if len(search_filter) > 0:
             results = results.where(self._build_search_criteria(search_filter))
         results = (
             results.as_("rel")
             .inV()
@@ -337,17 +354,21 @@
         else:
             id_ = serialized["identifier"]
             del serialized["identifier"]
 
         del serialized["ref_from"]
         del serialized["ref_to"]
 
+        g = self._get_g()
+
+        if not "identifier" in serialized:
+            # Remove SubGraphStrategy on inserting new edge for compatibility with Neptune 1.2
+            g = g.withoutStrategies(*TRAVERSAL_STRATEGIES)
         upsert = (
-            self._get_g()
-            .E(id_)
+            g.E(id_)
             .fold()
             .coalesce(
                 __.unfold(),
                 __.addE(relationship.get_namespace_name())
                 .property(T.id, id_)
                 .property(
                     Cardinality.single,
@@ -391,22 +412,28 @@
             self._get_g().V(id_).property(
                 Cardinality.single, "is_deleted", True
             ).both().property("is_deleted", True).iterate()
 
     def _make_relationship(self, relationship_def, data: Dict):
         from_dict = data["from"]
         from_dict["identifier"] = from_dict[T.id]
+        if not isinstance(from_dict["identifier"], str):
+            from_dict["identifier"] = from_dict["__id"]
         remove_managed_properties_and_delist(from_dict)
 
         to_dict = data["to"]
         to_dict["identifier"] = to_dict[T.id]
+        if not isinstance(to_dict["identifier"], str):
+            to_dict["identifier"] = to_dict["__id"]
         remove_managed_properties_and_delist(to_dict)
 
         rel_dict = data["rel"]
         rel_dict["identifier"] = rel_dict[T.id]
+        if not isinstance(rel_dict["identifier"], str):
+            rel_dict["identifier"] = rel_dict["__id"]
         remove_managed_properties_and_delist(rel_dict)
 
         rel_dict["ref_from"] = from_dict["identifier"]
         rel_dict["ref_to"] = to_dict["identifier"]
         return Entity.deserialize(relationship_def, rel_dict)
 
     @backoff.on_exception(
```

## Comparing `hmd_entity_storage-0.1.216.dist-info/METADATA` & `hmd_entity_storage-0.1.223.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: hmd-entity-storage
-Version: 0.1.216
+Version: 0.1.223
 Summary: basic storage library for entities and entity definitions
 Author: Alex Burgoon
 Author-email: alex.burgoon@hmdlabs.io
 License: Apache 2.0
 Requires-Dist: aenum (==2.2.6)
 Requires-Dist: aiohttp (==3.8.1)
 Requires-Dist: aiosignal (==1.2.0)
@@ -19,15 +19,15 @@
 Requires-Dist: cement (==3.0.6)
 Requires-Dist: certifi (==2022.12.7)
 Requires-Dist: charset-normalizer (==2.0.12)
 Requires-Dist: frozenlist (==1.3.0)
 Requires-Dist: google-auth (==2.9.1)
 Requires-Dist: greenlet (==1.1.2)
 Requires-Dist: gremlinpython (==3.5.2)
-Requires-Dist: hmd-cli-tools (~=1.1.227)
+Requires-Dist: hmd-cli-tools (~=1.1.228)
 Requires-Dist: hmd-meta-types (~=0.2.82)
 Requires-Dist: idna (==3.3)
 Requires-Dist: inquirerpy (==0.3.4)
 Requires-Dist: isodate (==0.6.1)
 Requires-Dist: jmespath (==0.10.0)
 Requires-Dist: jsonschema (==4.4.0)
 Requires-Dist: kubernetes (==24.2.0)
```

## Comparing `hmd_entity_storage-0.1.216.dist-info/RECORD` & `hmd_entity_storage-0.1.223.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 hmd_entity_storage/__init__.py,sha256=3Gi70PGXywWQ6Cvo3cFVIjEaC9gDBM6bl1lwnpwHCiA,214
-hmd_entity_storage/gremlin_query_support.py,sha256=lJFgo-3uAFMT8T_zPQbf1SJmEfG6hQ3zZJDobPJDSSU,2874
+hmd_entity_storage/gremlin_query_support.py,sha256=FY-SBk7-3f6g2QX-aen69Tiukbnc8wrhzBOszQUpI3E,2954
 hmd_entity_storage/hmd_entity_storage.py,sha256=3I6nzAf6KQ-AuWtQIpjNsYwvGQmG48U1wL_y2CPxyUA,393
 hmd_entity_storage/alembic/README,sha256=MVlc9TYmr57RbhXET6QxgyCcwWP7w-vLkEsirENqiIQ,38
 hmd_entity_storage/alembic/alembic.ini,sha256=wk9L3JNFwC9J7d2W6Q_mFwVzYesWlxXUj5GL3VbQf2c,1940
 hmd_entity_storage/alembic/env.py,sha256=Rs_ByK_bRi3NuTkum1YGNNFL3rpodW6Xk2Y4NYV8fPU,2287
 hmd_entity_storage/alembic/script.py.mako,sha256=8_xgA-gm_OhehnO7CiIijWgnm00ZlszEHtIHrAYFJl0,494
-hmd_entity_storage/alembic/__pycache__/env.cpython-39.pyc,sha256=zMOBHH3y4Iar66W6VyZlOu8SnTlUbJQQN9w-1AOHf10,1641
+hmd_entity_storage/alembic/__pycache__/env.cpython-39.pyc,sha256=gkHGO6MkTEGGmKGBqnyKvL9_jTUu1WzpiUDtkelqQqY,1641
 hmd_entity_storage/alembic/versions/12cdb83620a9_add_relationship.py,sha256=2kDdx_27wDXiHbzUOyrRv2fcZRBq0OlH8IYiu2GAJq4,1222
 hmd_entity_storage/alembic/versions/91c9eec02046_name_to_entity.py,sha256=xWUwP1JonSbNyP11iDG2wiT4KqkpIH6UsiFFuKDUxgo,1139
 hmd_entity_storage/alembic/versions/affe724897f1_initial_tables.py,sha256=roeN1mN20BObgI0GcyDjfNSHEbG25T0heC6SLJqeDVw,1480
 hmd_entity_storage/alembic/versions/bdf0a12db196_add_name_index.py,sha256=kG3Moot0KL4YCOhz1s8aluFdb5uMYNvMMNs4cAnignc,448
-hmd_entity_storage/alembic/versions/__pycache__/12cdb83620a9_add_relationship.cpython-39.pyc,sha256=vwjD3ECJXoEIpWF0csCOge5xMphjbLitpNHY4yXbXE8,1225
-hmd_entity_storage/alembic/versions/__pycache__/91c9eec02046_name_to_entity.cpython-39.pyc,sha256=dR4miHVusuttuBkbDEs0qRcpefiBHVp8ypqjifIhQvA,1291
-hmd_entity_storage/alembic/versions/__pycache__/affe724897f1_initial_tables.cpython-39.pyc,sha256=psWHpEHtqvkkSnODsq9H0TSWdvP3zEdLmNBWUkubwZc,1406
-hmd_entity_storage/alembic/versions/__pycache__/bdf0a12db196_add_name_index.cpython-39.pyc,sha256=AVnx_S42Rvm7x78y0Kb2Lw-a7uGLqH3XT3Sco0b9814,782
+hmd_entity_storage/alembic/versions/__pycache__/12cdb83620a9_add_relationship.cpython-39.pyc,sha256=1vLNajfacwDOgvKbemFLEKYKX5dUcIdCyEy2eswpz6k,1225
+hmd_entity_storage/alembic/versions/__pycache__/91c9eec02046_name_to_entity.cpython-39.pyc,sha256=khXSB-jucD6nbsD0RSWN4N9BVWy2sEY7VCHfleB_0pg,1291
+hmd_entity_storage/alembic/versions/__pycache__/affe724897f1_initial_tables.cpython-39.pyc,sha256=vjRVwrDT-4vZeKO58VDqxPlcdL7kZ0Yl9apqlika7As,1406
+hmd_entity_storage/alembic/versions/__pycache__/bdf0a12db196_add_name_index.cpython-39.pyc,sha256=_VBHbIWBalFyzyznZYxUmT9UcXifgHPxFfjnRi7IM1c,782
 hmd_entity_storage/auditor/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 hmd_entity_storage/auditor/engine_auditor.py,sha256=HiT-bFyx7Zoxpk3samK5MvNRrAOh0vhP3PNxoBIfYIo,11657
 hmd_entity_storage/engines/__init__.py,sha256=UGoJNv1iqa5b35-wauBE8Ouc0e8TvmuZ3K8lCghP_vg,219
 hmd_entity_storage/engines/base_engine.py,sha256=OWYeN6DEUEFAb7HmeAQ3I9VpOE3w66ecHI90Tbr2QCs,5138
 hmd_entity_storage/engines/dynamodb_engine.py,sha256=c2RUuo20BYu-G7YMU8JydYxK9hi2un40Qg0KmMiYHWY,16558
-hmd_entity_storage/engines/gremlin_engine.py,sha256=K8w13DfIzKl2K94NrBfPfiDqFjRfMOtATvY8eMYaGhw,15571
+hmd_entity_storage/engines/gremlin_engine.py,sha256=kXUssrjnc_EFTAJ0BqKPlXT7ugx6QqKp724fCNEW0-I,17116
 hmd_entity_storage/engines/postgres_engine.py,sha256=zlt-4dopyhEWn89DCzRsJSIApFNMJa5w6Jil8sUiIhE,21672
 hmd_entity_storage/engines/sqlite_engine.py,sha256=CtnnGsEmGEaQEykIda4Kd4xM_r_1xuKG6RdJxioA9bw,13257
-hmd_entity_storage-0.1.216.dist-info/METADATA,sha256=kXoyRXqhTo6WNwVqBEAMgGdFobtRj97YAy7w1BiFD4Y,2004
-hmd_entity_storage-0.1.216.dist-info/WHEEL,sha256=Ni9JGQXk2T4q02tFVwTZ-iAb8m9R1cjnSLMaE4VH1rg,92
-hmd_entity_storage-0.1.216.dist-info/top_level.txt,sha256=4ENZ1PVEHNIukrifW1816QqIfvlARoKX4E-_U4b-V4s,19
-hmd_entity_storage-0.1.216.dist-info/RECORD,,
+hmd_entity_storage-0.1.223.dist-info/METADATA,sha256=I1YvY-zkV2mfkU05r8ePw7H74O8KhuLqQFQCQAN0G8Y,2004
+hmd_entity_storage-0.1.223.dist-info/WHEEL,sha256=Ni9JGQXk2T4q02tFVwTZ-iAb8m9R1cjnSLMaE4VH1rg,92
+hmd_entity_storage-0.1.223.dist-info/top_level.txt,sha256=4ENZ1PVEHNIukrifW1816QqIfvlARoKX4E-_U4b-V4s,19
+hmd_entity_storage-0.1.223.dist-info/RECORD,,
```

